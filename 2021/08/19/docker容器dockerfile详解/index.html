<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>docker容器dockerfile详解 | qsing`s blog</title>
  <meta name="description" content="docker公司在容器技术发展中提出了镜像分层的理念，可以说也是这个革命性的理念让原本只不过是整合linux内核特性的容器，开始野蛮生长。 docker通过UnionFS联合文件系统将镜像的分层实现合并,关于镜像相关知识有兴趣的同学可参考我们之前文章《docker容器技术基础之联合文件系统OverlayFS》 本文是对docker官方文档Dockerfile reference学习与实践，在学习d">
<meta property="og:type" content="article">
<meta property="og:title" content="docker容器dockerfile详解">
<meta property="og:url" content="https://iqsing.github.io/2021/08/19/docker%E5%AE%B9%E5%99%A8dockerfile%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="qsing&#96;s blog">
<meta property="og:description" content="docker公司在容器技术发展中提出了镜像分层的理念，可以说也是这个革命性的理念让原本只不过是整合linux内核特性的容器，开始野蛮生长。 docker通过UnionFS联合文件系统将镜像的分层实现合并,关于镜像相关知识有兴趣的同学可参考我们之前文章《docker容器技术基础之联合文件系统OverlayFS》 本文是对docker官方文档Dockerfile reference学习与实践，在学习d">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-08-19T02:57:21.000Z">
<meta property="article:modified_time" content="2022-02-04T05:16:11.762Z">
<meta property="article:author" content="qsing">
<meta property="article:tag" content="dockerfile">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="https://iqsing.github.io/2021/08/19/docker%E5%AE%B9%E5%99%A8dockerfile%E8%AF%A6%E8%A7%A3/index.html">
  
    <link rel="alternate" href="/atom.xml" title="qsing`s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  <!-- font-awesome CSS -->
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
    
    

<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/iqsing" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">qsing</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Devops&amp;SRE</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="fa fa-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="fa fa-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      <!-- <span class="ins-close ins-selectable"><i class="fa fa-times"></i></span> -->
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav">
        
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="fa fa-fw fa-dashboard"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="fa fa-fw fa-delicious"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-categories active">
          <a href="/categories">
            
            <i class="fa fa-fw fa-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="fa fa-fw fa-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="fa fa-fw fa-code"></i>
            
            <span class="menu-title">项目</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="fa fa-fw fa-coffee"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/iqsing" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="fa fa-github"></i></a></li>
        
        <li><a href="https://twitter.com/Hi_Qsing" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="fa fa-twitter"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="fa fa-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h2 class="widget-title">[公告]</h2>
    <HR>
    <div class="widget-body">
        <div id="board">
            
            <div class="content">
                <p>您可以随意修改、发布本站内容，无需经过我本人同意!</p>
            </div>
        </div>
    </div>
    <HR>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">10</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/docker/linux/">linux</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a><span class="category-list-count">13</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/docker/">docker</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/network/">network</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/prometheus/">prometheus</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/zabbix/">zabbix</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cgroup/" rel="tag">Cgroup</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Copilot/" rel="tag">Copilot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DaemonSet/" rel="tag">DaemonSet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DataType/" rel="tag">DataType</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DateType/" rel="tag">DateType</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IO/" rel="tag">IO</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Namespace/" rel="tag">Namespace</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OverlayFS/" rel="tag">OverlayFS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PromQL/" rel="tag">PromQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RBAC/" rel="tag">RBAC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typora/" rel="tag">Typora</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/api/" rel="tag">api</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bridge/" rel="tag">bridge</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/celery/" rel="tag">celery</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/commandline/" rel="tag">commandline</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/configmap/" rel="tag">configmap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deployment/" rel="tag">deployment</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker-compose/" rel="tag">docker-compose</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dockerfile/" rel="tag">dockerfile</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag">golang</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/harbor/" rel="tag">harbor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/helm/" rel="tag">helm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/" rel="tag">https</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ingress/" rel="tag">ingress</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/job/" rel="tag">job</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/loadBalancer/" rel="tag">loadBalancer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/" rel="tag">network</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/picGo/" rel="tag">picGo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/restful/" rel="tag">restful</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/secret/" rel="tag">secret</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/service/" rel="tag">service</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/service-discovery/" rel="tag">service-discovery</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statefulset/" rel="tag">statefulset</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/storage/" rel="tag">storage</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/struct/" rel="tag">struct</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tsdb/" rel="tag">tsdb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-js/" rel="tag">vue.js</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/workflow/" rel="tag">workflow</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Cgroup/" style="font-size: 13px;">Cgroup</a> <a href="/tags/Copilot/" style="font-size: 13px;">Copilot</a> <a href="/tags/DaemonSet/" style="font-size: 13px;">DaemonSet</a> <a href="/tags/DataType/" style="font-size: 13px;">DataType</a> <a href="/tags/DateType/" style="font-size: 13px;">DateType</a> <a href="/tags/IO/" style="font-size: 13px;">IO</a> <a href="/tags/Namespace/" style="font-size: 13px;">Namespace</a> <a href="/tags/OverlayFS/" style="font-size: 13px;">OverlayFS</a> <a href="/tags/PromQL/" style="font-size: 13px;">PromQL</a> <a href="/tags/RBAC/" style="font-size: 13px;">RBAC</a> <a href="/tags/Typora/" style="font-size: 13px;">Typora</a> <a href="/tags/api/" style="font-size: 13.33px;">api</a> <a href="/tags/bridge/" style="font-size: 13px;">bridge</a> <a href="/tags/celery/" style="font-size: 13.33px;">celery</a> <a href="/tags/commandline/" style="font-size: 13.33px;">commandline</a> <a href="/tags/configmap/" style="font-size: 13px;">configmap</a> <a href="/tags/deployment/" style="font-size: 13px;">deployment</a> <a href="/tags/django/" style="font-size: 13.67px;">django</a> <a href="/tags/docker/" style="font-size: 13px;">docker</a> <a href="/tags/docker-compose/" style="font-size: 13px;">docker-compose</a> <a href="/tags/dockerfile/" style="font-size: 14px;">dockerfile</a> <a href="/tags/git/" style="font-size: 13px;">git</a> <a href="/tags/golang/" style="font-size: 13.67px;">golang</a> <a href="/tags/harbor/" style="font-size: 13px;">harbor</a> <a href="/tags/helm/" style="font-size: 13px;">helm</a> <a href="/tags/http/" style="font-size: 13px;">http</a> <a href="/tags/https/" style="font-size: 13px;">https</a> <a href="/tags/ingress/" style="font-size: 13px;">ingress</a> <a href="/tags/job/" style="font-size: 13px;">job</a> <a href="/tags/k8s/" style="font-size: 13px;">k8s</a> <a href="/tags/loadBalancer/" style="font-size: 13px;">loadBalancer</a> <a href="/tags/network/" style="font-size: 13px;">network</a> <a href="/tags/picGo/" style="font-size: 13px;">picGo</a> <a href="/tags/restful/" style="font-size: 13px;">restful</a> <a href="/tags/secret/" style="font-size: 13px;">secret</a> <a href="/tags/service/" style="font-size: 13px;">service</a> <a href="/tags/service-discovery/" style="font-size: 13px;">service-discovery</a> <a href="/tags/statefulset/" style="font-size: 13px;">statefulset</a> <a href="/tags/storage/" style="font-size: 13px;">storage</a> <a href="/tags/struct/" style="font-size: 13px;">struct</a> <a href="/tags/tsdb/" style="font-size: 13px;">tsdb</a> <a href="/tags/vim/" style="font-size: 13px;">vim</a> <a href="/tags/vue-js/" style="font-size: 13px;">vue.js</a> <a href="/tags/workflow/" style="font-size: 13px;">workflow</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/prometheus/">prometheus</a>
              </p>
              <p class="item-title">
                <a href="/2022/04/15/Prometheus%20TSDB%E5%AD%98%E5%82%A8%E5%8E%9F%E7%90%86/" class="title">Prometheus TSDB存储原理</a>
              </p>
              <p class="item-date">
                <time datetime="2022-04-15T12:16:21.000Z" itemprop="datePublished">2022-04-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/prometheus/">prometheus</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/07/promql%20%E5%85%A8%E8%A7%A3%E6%9E%90/" class="title">PromQL全解析</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-07T05:16:21.000Z" itemprop="datePublished">2022-03-07</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/prometheus/">prometheus</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/03/prometheus%20k8s%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0/" class="title">prometheus k8s服务发现</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-03T12:16:21.000Z" itemprop="datePublished">2022-03-03</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/k8s/">k8s</a>
              </p>
              <p class="item-title">
                <a href="/2022/02/14/k8s%20%E9%80%9A%E8%BF%87%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8helm%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8/" class="title">k8s 通过helm发布应用</a>
              </p>
              <p class="item-date">
                <time datetime="2022-02-13T16:47:21.000Z" itemprop="datePublished">2022-02-14</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/network/">network</a>
              </p>
              <p class="item-title">
                <a href="/2022/02/07/%E7%90%86%E8%A7%A3https%E4%B8%AD%E7%9A%84%E5%AE%89%E5%85%A8%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" class="title">理解https中的安全及其实现原理</a>
              </p>
              <p class="item-date">
                <time datetime="2022-02-06T16:47:21.000Z" itemprop="datePublished">2022-02-07</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-docker容器dockerfile详解" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      docker容器dockerfile详解
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="fa fa-calendar-check-o"></i>
	<a href="/2021/08/19/docker%E5%AE%B9%E5%99%A8dockerfile%E8%AF%A6%E8%A7%A3/" class="article-date">
	  <time datetime="2021-08-19T02:57:21.000Z" itemprop="datePublished">2021-08-19</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/docker/">docker</a>
  </span>

        
  <span class="article-tag">
    <i class="fa fa-tag"></i>
	<a class="article-tag-link-link" href="/tags/dockerfile/" rel="tag">dockerfile</a>
  </span>


        

        <span class="post-comment"><i class="fa fa-commenting-o"></i> <a href="/2021/08/19/docker%E5%AE%B9%E5%99%A8dockerfile%E8%AF%A6%E8%A7%A3/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 4.2k(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 17(分)</span>
	

      </div>
      
    </div>
    <div class="article-entry markdown-body" itemprop="articleBody">
      
        <p>docker公司在容器技术发展中提出了<strong>镜像分层</strong>的理念，可以说也是这个革命性的理念让原本只不过是整合linux内核特性的容器，开始野蛮生长。</p>
<p>docker通过UnionFS联合文件系统将镜像的分层实现合并,关于镜像相关知识有兴趣的同学可参考我们之前文章《docker容器技术基础之联合文件系统OverlayFS》</p>
<p>本文是对docker官方文档<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference</a>学习与实践，在学习docker容器相关技术的同学别光收藏，你要动起来！实践起来！</p>
<p><strong>提示：没有人比docker公司更懂docker，本小作文含部分自己的理解，有英文阅读习惯的同学，建议直接阅读官方文档哈。</strong></p>
<hr>
<h4 id="docker-build"><a href="#docker-build" class="headerlink" title="docker build"></a>docker build</h4><p>Dockerfile是一个镜像构建命令集合的文本文件，下面是我们最常见的Dockerfile构建,假如我们目录下有一个文件Dockerfile</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx_project]<span class="comment"># ls</span></span><br><span class="line">Dockerfile</span><br><span class="line">[root@localhost nginx_project]<span class="comment"># docker build -t nginx:v1 .</span></span><br></pre></td></tr></table></figure>

<p>通过build指定了目标镜像的<strong>标签</strong>为nginx:v1，以及Dockerfile的<strong>上下文context .</strong> </p>
<p><strong>什么是docker上下文？</strong></p>
<p><strong>一个面向服务端的目录夹结构，除了Dockerfile，你的一切构建资源都应该在这个目录（指定的上下文）中。</strong></p>
<p>上下文是递归处理的。因此， 如果是<code>PATH</code>则包含任何子目录，如果是一个<code>URL</code>则包含存储库及其子模块。</p>
<p>关键点，构建是由 Docker 守护程序运行，而不是由 CLI 运行，所以docker会把上下文资源打包传输给守护进程进行构建，为了减少不必要的臃肿，最好从一个空目录作为上下文开始，并将 Dockerfile 保存在该目录中。仅添加构建 Dockerfile 所需的文件。</p>
<p>我们可以使用<code>-f</code>选项指定dockerfile</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost folder]<span class="comment"># docker build -f ../Dockerfile -t nginx:v1 .</span></span><br></pre></td></tr></table></figure>

<p>使用多个<code>-t</code>选项保持多个tag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost folder]<span class="comment"># docker build  -t nginx:v1 -t dockerhub.com/nginx:v2 .</span></span><br><span class="line">Sending build context to Docker daemon  1.583kB</span><br><span class="line">Step 1/2 : FROM nginx</span><br><span class="line"> ---&gt; 08b152afcfae</span><br><span class="line">Step 2/2 : run <span class="built_in">echo</span> 123</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 3b636c79fbfa</span><br><span class="line">Successfully built 3b636c79fbfa</span><br><span class="line">Successfully tagged nginx:v1</span><br><span class="line">Successfully tagged dockerhub.com/nginx:v2</span><br></pre></td></tr></table></figure>

<p>这样就构建两个不同tag的同一ID镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost folder]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">dockerhub.com/nginx   v2        3b636c79fbfa   23 minutes ago   133MB</span><br><span class="line">nginx                 v1        3b636c79fbfa   23 minutes ago   133MB</span><br></pre></td></tr></table></figure>

<h4 id="BuildKit"><a href="#BuildKit" class="headerlink" title="BuildKit"></a>BuildKit</h4><p>buildkit将 Dockerfile 变成了 Docker 镜像。它不只是构建 Docker 镜像；它可以构建 OCI 图像和其他几种输出格式。</p>
<p>从版本18.09开始，Docker支持由<a target="_blank" rel="noopener" href="https://github.com/moby/buildkit">moby / buildkit</a>项目提供的用于执行构建的新后端。与旧的实现相比，BuildKit后端提供了许多好处。例如，BuildKit可以：</p>
<ul>
<li>检测并跳过执行未使用的构建阶段。</li>
<li>平行构建独立的构建阶段。</li>
<li>在不同的构建过程中,只增加传输构建上下文中的更改文件。</li>
<li>在构建上下文中检测并跳过传输未使用的文件。</li>
<li>使用外部Dockerfile实现许多新功能。</li>
<li>避免与API的其他部分(中间镜像和容器)产生副作用。</li>
<li>优先处理您的构建缓存,以便自动修剪。</li>
</ul>
<p>要使用BuildKit后端，只需要在调用 <code>DOCKER_BUILDKIT=1</code> <code>docker build</code> 之前在CLI上设置环境变量DOCKER_BUILDKIT = 1。或者配置/etc/docker/daemon.json启用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost folder]<span class="comment">#  DOCKER_BUILDKIT=1 docker build -f ../Dockerfile -t nginx:v1 -t dockerhub.com/nginx:v2 .</span></span><br><span class="line">[+] Building 5.2s (6/6) FINISHED                                                                           </span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                  0.7s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 118B                                                                  0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                     0.6s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                       0.0s</span><br><span class="line"> =&gt; [internal] load metadata <span class="keyword">for</span> docker.io/library/nginx:latest                                       0.0s</span><br><span class="line"> =&gt; [1/2] FROM docker.io/library/nginx                                                                2.2s</span><br><span class="line"> =&gt; [2/2] RUN <span class="built_in">echo</span> 123                                                                                1.3s</span><br><span class="line"> =&gt; exporting to image                                                                                0.5s </span><br><span class="line"> =&gt; =&gt; exporting layers                                                                               0.2s</span><br><span class="line"> =&gt; =&gt; writing image sha256:813b09c58322dce98ee28e717baeb9f3593ce3e46a032488949250f761004495          0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/nginx:v1                                                           0.0s</span><br><span class="line"> =&gt; =&gt; naming to dockerhub.com/nginx:v2 </span><br></pre></td></tr></table></figure>

<hr>
<h4 id="dockerfile格式"><a href="#dockerfile格式" class="headerlink" title="dockerfile格式"></a>dockerfile格式</h4><h5 id="1、注释"><a href="#1、注释" class="headerlink" title="1、注释"></a>1、注释</h5><p>一个标准的dockerfile，注释是必须的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这是dockerfile注释,dockerfile中指令以&quot;CMD args&quot;格式出现</span></span><br><span class="line">CMD args</span><br><span class="line">CMD args</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>一个<code>Dockerfile</code> <strong>第一个指令必须是<code>FROM</code>指令</strong>，用于指定基础镜像，那么基础镜像的父镜像从哪里来？答案是<code>scratch</code>带有该<code>FROM scratch</code>指令的 Dockerfile会创建一个<strong>基本映像</strong>。</p>
<h5 id="2-解析器指令"><a href="#2-解析器指令" class="headerlink" title="2.解析器指令"></a>2.解析器指令</h5><p>解析器指令是可选的，会影响 a<code>Dockerfile</code>中后续行的处理方式。解析器指令不会向构建添加层，也不会显示为构建步骤，单个指令只能使用一次。</p>
<p>dockerfile目前支持以下两个解析器指令：</p>
<ul>
<li><code>syntax</code></li>
<li><code>escape</code></li>
</ul>
<h5 id="2-1syntax"><a href="#2-1syntax" class="headerlink" title="2.1syntax"></a>2.1syntax</h5><p>此功能仅在使用<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#buildkit">BuildKit</a>后端时可用，在使用经典构建器后端时会被忽略。</p>
<p>我们可以在dockerfile文件开头指定此dockerfile语法解析器，如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line"><span class="comment"># syntax=docker.io/docker/dockerfile:1</span></span><br><span class="line"><span class="comment"># syntax=example.com/user/repo:tag@sha256:abcdef...</span></span><br></pre></td></tr></table></figure>

<p>通过syntax自定义 Dockerfile 语法解析器可以实现如下：</p>
<ul>
<li>在不更新 Docker 守护进程的情况下自动修复错误</li>
<li>确保所有用户都使用相同的解析器来构建您的 Dockerfile</li>
<li>无需更新 Docker 守护程序即可使用最新功能</li>
<li>在将新功能或第三方功能集成到 Docker 守护进程之前试用它们</li>
<li>使用<a target="_blank" rel="noopener" href="https://github.com/moby/buildkit#exploring-llb">替代的构建定义，或创建自己的定义</a></li>
</ul>
<p>官方dockerfile解析器：</p>
<ul>
<li><code>docker/dockerfile:1</code>  不断更新最新的<code>1.x.x</code>次要<em>和</em>补丁版本</li>
<li><code>docker/dockerfile:1.2</code>  保持更新最新的<code>1.2.x</code>补丁版本，一旦版本<code>1.3.0</code>发布就停止接收更新。</li>
<li><code>docker/dockerfile:1.2.1</code>  不可变：从不更新1.2版本</li>
</ul>
<p>比如我们使用1.2最新补丁版本，我们的Dockerfile如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#syntax=docker/dockerfile:1.2</span></span><br><span class="line"><span class="keyword">FROM</span> busybox</span><br><span class="line"><span class="keyword">run</span><span class="bash"> <span class="built_in">echo</span> 123</span></span><br></pre></td></tr></table></figure>

<p>我们启用buildkit构建</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DOCKER_BUILDKIT=1 docker build -t busybox:v1 .</span></span><br><span class="line">[+] Building 5.8s (8/8) FINISHED                                                                           </span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                  0.3s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 150B                                                                  0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                     0.4s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                       0.0s</span><br><span class="line"> =&gt; resolve image config <span class="keyword">for</span> docker.io/docker/dockerfile:1.2                                          2.6s</span><br><span class="line"> =&gt; CACHED docker-image://docker.io/docker/dockerfile:1.2@sha256:e2a8561e419ab1ba6b2fe6cbdf49fd92b95  0.0s</span><br><span class="line"> =&gt; [internal] load metadata <span class="keyword">for</span> docker.io/library/busybox:latest                                     0.0s</span><br><span class="line"> =&gt; [1/2] FROM docker.io/library/busybox                                                              0.3s</span><br><span class="line"> =&gt; [2/2] RUN <span class="built_in">echo</span> 123                                                                                1.1s</span><br><span class="line"> =&gt; exporting to image                                                                                0.3s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                               0.3s</span><br><span class="line"> =&gt; =&gt; writing image sha256:bd66a3db9598d942b68450a7ac08117830b4d66b68180b6e9d63599d01bc8a04          0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/busybox:v1</span><br></pre></td></tr></table></figure>

<h5 id="2-2-escape"><a href="#2-2-escape" class="headerlink" title="2.2 escape"></a>2.2 escape</h5><p>通过escape定义dockerfile的换行拼接转义符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># escape=\   </span></span><br></pre></td></tr></table></figure>

<p>如果要构建一个window镜像就有大用处了，我们看下面dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> microsoft/nanoserver</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> testfile.txt c:\\</span></span><br><span class="line"><span class="bash">RUN dir c:\</span></span><br></pre></td></tr></table></figure>

<p>由于默认转义符为<code>\</code>，则在构建的第二步step2会是这样<code>COPY testfile.txt c:\RUN dir c:</code>显然与我们的预期不符。</p>
<p>我们把转义符换成`号即可</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># escape=`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> microsoft/nanoserver</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> testfile.txt c:\ `</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> dir c:\</span></span><br></pre></td></tr></table></figure>

<h5 id="3-类bash的环境变量"><a href="#3-类bash的环境变量" class="headerlink" title="3.类bash的环境变量"></a>3.类bash的环境变量</h5><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> busybox</span><br><span class="line"><span class="keyword">ENV</span> FOO=/bar</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$&#123;FOO&#125;</span>   <span class="comment"># WORKDIR /bar</span></span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> . <span class="variable">$FOO</span>       <span class="comment"># ADD . /bar</span></span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> \<span class="variable">$FOO</span> /quux <span class="comment"># COPY $FOO /quux</span></span></span><br></pre></td></tr></table></figure>

<p><code>$&#123;variable_name&#125;</code>语法还支持<code>bash</code> 指定的一些标准修饰符：</p>
<ul>
<li><code>$&#123;variable:-word&#125;</code>表示如果<code>variable</code>变量被设置（存在），则结果将是该值。如果<code>variable</code>未设置，<code>word</code>则将是结果。</li>
<li><code>$&#123;variable:+word&#125;</code>表示如果<code>variable</code>被设置则为<code>word</code>结果，否则为空字符串。</li>
</ul>
<h5 id="4-dockerignore"><a href="#4-dockerignore" class="headerlink" title="4. .dockerignore"></a>4. .dockerignore</h5><p>.dockerignore用于忽略CLI发送到docker守护进程的文件或目录。以下是一个<code>.dockerignore</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#.dockeringre可以有注释</span><br><span class="line">*.md</span><br><span class="line">!README.md</span><br><span class="line">temp?</span><br><span class="line">*/temp*</span><br><span class="line">*/*/temp*</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">规则</th>
<th align="left">行为</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>*/temp*</code></td>
<td align="left">排除名称以<code>temp</code>根目录的任何直接子目录开头的文件和目录。例如，纯文件<code>/somedir/temporary.txt</code>被排除在外，目录<code>/somedir/temp</code>.</td>
</tr>
<tr>
<td align="left"><code>*/*/temp*</code></td>
<td align="left">排除<code>temp</code>从根目录下两级的任何子目录开始的文件和目录。例如，<code>/somedir/subdir/temporary.txt</code>被排除在外。</td>
</tr>
<tr>
<td align="left"><code>temp?</code></td>
<td align="left">排除根目录中名称为一个字符扩展名的文件和目录<code>temp</code>。例如，<code>/tempa</code>和<code>/tempb</code>被排除在外。</td>
</tr>
<tr>
<td align="left"><em>！</em></td>
<td align="left">不排除到文件</td>
</tr>
</tbody></table>
<hr>
<h4 id="dockerfile命令"><a href="#dockerfile命令" class="headerlink" title="dockerfile命令"></a>dockerfile命令</h4><h5 id="1-FROM"><a href="#1-FROM" class="headerlink" title="1.FROM"></a>1.FROM</h5><p>指定基础镜像。一般格式如下，<code>[]</code>括号内容可省略：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> [--platform=&lt;platform&gt;] &lt;image&gt;[:&lt;tag&gt;] [AS &lt;name&gt;]</span><br></pre></td></tr></table></figure>

<p>特别需要注意的是<code>FROM</code>在一个dockerfile中可以多次出现，以实现多阶段构建。并且可以和ARG 参数交互。如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span>  CODE_VERSION=latest</span><br><span class="line"><span class="keyword">FROM</span> base:$&#123;CODE_VERSION&#125;</span><br><span class="line"><span class="keyword">CMD</span><span class="bash">  /code/run-app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> extras:$&#123;CODE_VERSION&#125;</span><br><span class="line"><span class="keyword">CMD</span><span class="bash">  /code/run-extras</span></span><br></pre></td></tr></table></figure>

<p>我们加载了两个通过arg参数指定的不同版本基础镜像。</p>
<h5 id="2-RUN"><a href="#2-RUN" class="headerlink" title="2.RUN"></a>2.RUN</h5><p>RUN的两种形式</p>
<ul>
<li>RUN <command>        首选， (命令在shell中运行,即默认为/bin/sh -c )</li>
<li>RUN [“exec”,param1,param2]      </li>
</ul>
<p>RUN命令主要是在镜像构建时执行，形成新层。比如我们经常会看到在构建镜像时安装相关软件。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y gcc </span></span><br></pre></td></tr></table></figure>

<p>当我们不想使用默认shell是可以采用exec形式实现</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> [<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;yum install -y gcc&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>当然，exec形式可以不使用shell</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> [<span class="string">&quot;yum&quot;</span>,<span class="string">&quot;install&quot;</span>,<span class="string">&quot;-y&quot;</span>,<span class="string">&quot;gcc&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p><em>EXEC</em>形式被解析为一个JSON阵列，所以必须使用双引号</p>
<h5 id="3-CMD"><a href="#3-CMD" class="headerlink" title="3.CMD"></a>3.CMD</h5><p><code>CMD</code>指令有三种形式：</p>
<ul>
<li><code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</code>（<em>exec</em>形式，这是首选形式）</li>
<li><code>CMD [&quot;param1&quot;,&quot;param2&quot;]</code>（作为<em>ENTRYPOINT 的默认参数</em>）</li>
<li><code>CMD command param1 param2</code>（shell形式）</li>
</ul>
<p>一个dockerfile中，应该只写一个CMD，如果有多个只有最后一个生效。在实际编写dockerfie时CMD命令常常用于为<em>ENTRYPOINT</em>提供默认值，后面我们会讲到。</p>
<p><strong>与RUN相比，CMD在构建时不会执行任何操作，主要用于指定镜像的启动命令。CMD的启动命令可以被docker run 参数代替。</strong></p>
<p>我们在dockerfile中添加如下CMD命令</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">echo</span> hello</span></span><br></pre></td></tr></table></figure>

<p>构建镜像后，docker run 不添加参数，启动容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost dockerfiles]<span class="comment"># docker run centos:v1</span></span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<p>当我们在docker run 添加参数后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost dockerfiles]<span class="comment"># docker run centos_env:v1 echo container</span></span><br><span class="line">container </span><br></pre></td></tr></table></figure>

<p>显然我们CMD命令echo hello已被docker run中的参数echo container取代。</p>
<h5 id="4-LABEL"><a href="#4-LABEL" class="headerlink" title="4. LABEL"></a>4. LABEL</h5><p>label用于添加镜像的元数据，采用key-value的形式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LABEL &lt;key&gt;=&lt;value&gt;</span><br></pre></td></tr></table></figure>

<p>比如我们添加如下LABEL</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> <span class="string">&quot;miantainer&quot;</span>=<span class="string">&quot;iqsing.github.io&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> <span class="string">&quot;version&quot;</span>=<span class="string">&quot;v1.2&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> <span class="string">&quot;author&quot;</span>=<span class="string">&quot;waterman&amp;&amp;iqsing&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>为了防止创建三层，我们最好通过一个标签来写。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> <span class="string">&quot;miantainer&quot;</span>=<span class="string">&quot;iqsing.github.io&quot;</span> \</span></span><br><span class="line"><span class="bash">      <span class="string">&quot;version&quot;</span>=<span class="string">&quot;v1.2&quot;</span> \</span></span><br><span class="line"><span class="bash">      <span class="string">&quot;author&quot;</span>=<span class="string">&quot;waterman&amp;&amp;iqsing&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>我们通过docker inspect 来查看镜像label信息</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#docker inspect centos_labels:v1</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;Labels&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;waterman&amp;&amp;iqsing&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;miantainer&quot;</span>: <span class="string">&quot;iqsing.github.io&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;org.label-schema.build-date&quot;</span>: <span class="string">&quot;20201204&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;org.label-schema.license&quot;</span>: <span class="string">&quot;GPLv2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;org.label-schema.name&quot;</span>: <span class="string">&quot;CentOS Base Image&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;org.label-schema.schema-version&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;org.label-schema.vendor&quot;</span>: <span class="string">&quot;CentOS&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;v1.2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="5-EXPOSE"><a href="#5-EXPOSE" class="headerlink" title="5.EXPOSE"></a>5.EXPOSE</h5><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/tcp</span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">161</span>/udp</span><br></pre></td></tr></table></figure>

<p>注意，EXPOSE只是告诉dockerfile的阅读者，我们构建的镜像需要暴露哪些端口，只是一个信息。在容器中还是需要通过<code>-p</code>选项来暴露端口。</p>
<h5 id="6-ENV"><a href="#6-ENV" class="headerlink" title="6.ENV"></a>6.ENV</h5><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ... 首先方式</span><br><span class="line">或</span><br><span class="line"><span class="keyword">ENV</span> &lt;key&gt;  &lt;value&gt;</span><br></pre></td></tr></table></figure>

<p>通过ENV指定环境变量，将作用于在构建阶段的所有后续指令的环境中。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> username=<span class="string">&quot;iqsing&quot;</span></span><br></pre></td></tr></table></figure>

<p>这样当我们启动这个容器后可以查看到容器信息已经附带了<code>ENV</code>环境变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;Env&quot;: [</span><br><span class="line">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">&quot;username=iqsing&quot;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>当然我们也可以在启动容器时添加环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --env &lt;key&gt;=&lt;value&gt;</span><br></pre></td></tr></table></figure>

<p>另外如果只需要在镜像构建期间使用环境变量，更好的选择是使用<code>ARG</code>参数来处理</p>
<h5 id="7-ADD-amp-amp-COPY"><a href="#7-ADD-amp-amp-COPY" class="headerlink" title="7.ADD &amp;&amp; COPY"></a>7.ADD &amp;&amp; COPY</h5><p>ADD和COPY格式相似，有两种形式,包含空格的路径需要后一种形式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> [--chown=&lt;user&gt;:&lt;group&gt;] [<span class="string">&quot;&lt;src&gt;&quot;</span>,... <span class="string">&quot;&lt;dest&gt;&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> [--chown=&lt;user&gt;:&lt;group&gt;] [<span class="string">&quot;&lt;src&gt;&quot;</span>,... <span class="string">&quot;&lt;dest&gt;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>在linux平台中可以对添加到远程目录或文件设置所属用户和组。</p>
<p><code>&lt;SRC&gt; </code>指复制新文件、目录或远程文件 URL，每<code>&lt;src&gt;</code>可以包含通配符，如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> hom* /mydir/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> hom?.txt /mydir/</span></span><br></pre></td></tr></table></figure>

<p>一般使用中，ADD、COPY都遵守以下规则：</p>
<ul>
<li><p><code>&lt;src&gt;</code>路径必须是内部<em>语境</em>的构建; 你不能<code>COPY ../something /something</code>，因为 <code>docker build</code>是将上下文目录（和子目录）发送到 docker 守护进程。</p>
</li>
<li><p>如果<code>&lt;src&gt;</code>是目录，则复制目录的全部内容，包括文件系统元数据。</p>
</li>
<li><p>如果<code>&lt;src&gt;</code>是任何其他类型的文件，则将其与其元数据一起单独复制。在这种情况下，如果<code>&lt;dest&gt;</code>以斜杠结尾<code>/</code>，它将被视为一个目录，其内容<code>&lt;src&gt;</code>将被写入<code>&lt;dest&gt;/base(&lt;src&gt;)</code>。</p>
</li>
<li><p>如果<code>&lt;src&gt;</code>直接指定了多个资源，或者由于使用了通配符，则<code>&lt;dest&gt;</code>必须是目录，并且必须以斜杠结尾<code>/</code>。</p>
</li>
<li><p>如果<code>&lt;dest&gt;</code>不以斜杠结尾，则将其视为常规文件，并将其内容<code>&lt;src&gt;</code>写入<code>&lt;dest&gt;</code>.</p>
</li>
<li><p>如果<code>&lt;dest&gt;</code>不存在，则在其路径中创建所有丢失的目录。</p>
</li>
</ul>
<p><strong>特别的，当<src>是可识别的压缩包如gzip、bzip2等tar包时，首先会将包添加到镜像中，然后自动解压。这可以说是与COPY命令在使用中的最大的区别。</strong></p>
<h5 id="8-ENTRYPOINT"><a href="#8-ENTRYPOINT" class="headerlink" title="8.ENTRYPOINT"></a>8.ENTRYPOINT</h5><p>exec首选和shell形式:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">command</span> param1 param2</span></span><br></pre></td></tr></table></figure>

<p><strong>ENTRYPOINT 和CMD很相似，都是指定启动命令，不同之处在于ENTRYPOINT 指定的命令无法被docker run 参数取代。</strong></p>
<p>我们在dockerfile中添加ENTRYPOINT</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">echo</span> hello container</span></span><br></pre></td></tr></table></figure>

<p>构建镜像并启动容器，可以看到docker run 中的参数并未取代ENTRYPOINT</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost dockerfiles]<span class="comment"># docker run centos_entrtpoint:v1 echo hello docker</span></span><br><span class="line">hello container</span><br></pre></td></tr></table></figure>

<p><strong>这指令优秀的另一个地方在于可以和CMD指令做交互。让容器以应用或者服务运行。</strong></p>
<p>经典操作：<code>ENTRYPOINT</code> + <code>CMD</code> = 默认容器命令参数</p>
<p>ENTRYPOINT是dockerfile中非常重要的指令，有必要另写一篇小作文深入学习一下这东西。</p>
<h5 id="9-VOLUME"><a href="#9-VOLUME" class="headerlink" title="9.VOLUME"></a>9.VOLUME</h5><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;/data&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>volume指令可以用于创建存储卷，我来看一下实例：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /volume</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span> &gt; /volume/greeting</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /volume</span></span><br></pre></td></tr></table></figure>

<p>构建镜像后，创建一个容器</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost dockerfiles]# docker create   --name centos_volume  centos_volue:v1</span><br><span class="line">[root@localhost dockerfiles]# docker inspect centos_volume </span><br><span class="line"></span><br><span class="line"> <span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Name&quot;</span>: <span class="string">&quot;494cdb193984680045c36a16bbc2b759cf568b55c7e9b0852ccf6dff8bf79c46&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/494cdb193984680045c36a16bbc2b759cf568b55c7e9b0852ccf6dff8bf79c46/_data&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Destination&quot;</span>: <span class="string">&quot;/volume&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样我们就通过VOLUME指令创建一个存储卷，你可以通过<code>--volumes-from</code>共享这个容器，可参考我之前的小作文《docker容器存储》</p>
<h5 id="10-USER"><a href="#10-USER" class="headerlink" title="10.USER"></a>10.USER</h5><p>指定指令集所属用户和组。组默认为root。可以作用于<code>RUN</code>，<code>CMD</code>和 <code>ENTRYPOINT</code>它们后面的指令。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USER</span> &lt;<span class="keyword">user</span>&gt;[:&lt;group&gt;]</span><br><span class="line">或</span><br><span class="line"><span class="keyword">USER</span> &lt;UID&gt;[:&lt;GID&gt;]</span><br></pre></td></tr></table></figure>

<h5 id="11-WORKDIR"><a href="#11-WORKDIR" class="headerlink" title="11.WORKDIR"></a>11.WORKDIR</h5><p>指定指令集所在的工作目录，若目录不存在将会自动创建。可作用于<code>RUN</code>，<code>CMD</code>， <code>ENTRYPOINT</code>，<code>COPY</code>和<code>ADD</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /path/to/workdir</span></span><br></pre></td></tr></table></figure>

<h5 id="12-ARG"><a href="#12-ARG" class="headerlink" title="12.ARG"></a>12.ARG</h5><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> &lt;name&gt;[=&lt;default value&gt;]</span><br></pre></td></tr></table></figure>

<p><code>ARG</code>指令定义了一个变量，我们可以在<code>docker build</code>通过使用<code>--build-arg &lt;varname&gt;=&lt;value&gt;</code> 标志的命令将其传递给构建器。</p>
<ul>
<li><p>如果<code>ARG</code>指令具有默认值并且在构建时没有传递任何值，则构建器使用默认值。</p>
</li>
<li><p>在多阶段构建应该添加多个ARG</p>
</li>
<li><p>ENV变量会覆盖ARG变量</p>
</li>
<li><p>与ENV变量相比，ARG变量多用于构建，无法驻留在镜像中。</p>
</li>
</ul>
<h5 id="13-STOPSIGNAL"><a href="#13-STOPSIGNAL" class="headerlink" title="13.STOPSIGNAL"></a>13.STOPSIGNAL</h5><p>配置容器退出时的系统调用</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">STOPSIGNAL</span> signal</span><br></pre></td></tr></table></figure>

<h5 id="14-HEALTHCHECK"><a href="#14-HEALTHCHECK" class="headerlink" title="14.HEALTHCHECK"></a>14.HEALTHCHECK</h5><p><code>HEALTHCHECK</code>指令有两种形式：</p>
<ul>
<li><code>HEALTHCHECK [OPTIONS] CMD command</code> （通过在容器内运行命令来检查容器健康状况）</li>
<li><code>HEALTHCHECK NONE</code> （禁用从基础镜像继承的任何健康检查）</li>
</ul>
<p>OPTIONS支持如下参数：</p>
<ul>
<li><code>--interval=DURATION</code>（默认值：<code>30s</code>）</li>
<li><code>--timeout=DURATION</code>（默认值：<code>30s</code>）</li>
<li><code>--start-period=DURATION</code>（默认值：<code>0s</code>）</li>
<li><code>--retries=N</code>（默认值：<code>3</code>）</li>
</ul>
<p>比如我们可以添加如下参数用于检查web服务：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">HEALTHCHECK</span><span class="bash"> --interval=5m --timeout=3s \</span></span><br><span class="line"><span class="bash">  CMD curl -f http://localhost/ || <span class="built_in">exit</span> 1</span></span><br></pre></td></tr></table></figure>

<p>每五分钟左右检查一次web服务器能否在3s内响应。如果失败则返回状态码1</p>
<p>命令的退出状态指示容器的健康状态。可能的值为：</p>
<ul>
<li>0：成功 - 容器运行良好，可以使用</li>
<li>1：不健康 - 容器无法正常工作</li>
<li>2：reserved - 不要使用这个退出代码</li>
</ul>
<hr>
<p>编写一个优质的Dockerfile并不容易，你需要考虑所构建镜像的迭代、服务稳定运行、启动与停止、安全等等问题，希望这篇小作文可以帮助你对Dockerfile有多一点了解。</p>
<p><strong>您可以随意转载、修改、发布本文章，无需经过本人同意。</strong> 个人blog：<a href="https://iqsing.github.io/">iqsing.github.io</a></p>
<hr>
<h4 id="NEXT"><a href="#NEXT" class="headerlink" title="NEXT"></a>NEXT</h4><ul>
<li>Dockerfile 理解ENTRYPOINT与CMD结合</li>
<li>Dockerfile 多阶段构建实践</li>
<li>Dockerfile 与docker容器安全实践</li>
</ul>

      
    </div>
    <div class="article-footer">
      <!--<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://iqsing.github.io/2021/08/19/docker%E5%AE%B9%E5%99%A8dockerfile%E8%AF%A6%E8%A7%A3/" title="docker容器dockerfile详解" target="_blank" rel="external">https://iqsing.github.io/2021/08/19/docker%E5%AE%B9%E5%99%A8dockerfile%E8%AF%A6%E8%A7%A3/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul> 
</blockquote> 


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/iqsing" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/iqsing" target="_blank"><span class="text-dark">qsing</span><small class="ml-1x">Devops&amp;SRE</small></a></h3>
        <div>个人简介。</div>
      </div>
    </figure>
  </div>
</div>

-->

    </div>
  </article>
  
    
  <section id="comments">
  	
       
    <div id="uyan_frame"></div>

    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/08/23/dockerfile%E4%B8%ADENTRYPOINT%E4%B8%8ECMD%E7%9A%84%E7%BB%93%E5%90%88/" title="dockerfile中ENTRYPOINT与CMD的结合"><i class="fa fa-angle-left" aria-hidden="true"></i>&nbsp;&nbsp;上一篇</a>
    </li>
    
    
    <li class="next">
      <a href="/2021/08/12/docker%E5%AE%B9%E5%99%A8%E5%AD%98%E5%82%A8/" title="docker容器存储">下一篇&nbsp;&nbsp;<i class="fa fa-angle-right" aria-hidden="true"></i></a>
    </li>
    
  </ul>
  
  
  
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/iqsing" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="fa fa-github"></i></a></li>
        
        <li><a href="https://twitter.com/Hi_Qsing" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="fa fa-twitter"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="fa fa-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2022 qsing
        
        <div class="publishby">
        	Powered by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div> 
    </div>
</footer>
  <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.js"></script>


<script src="/js/application.js"></script>

  
    
    
    
        <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>

    
    
    
        


    
    
        
    
    <script defer type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=[object Object]"></script>


    
    



  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
      z-index: 2;
    }

    .highlight-wrap:hover .copy-btn,
        .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  
  <script>
    addLoadEvent(()=>{
      $('.highlight').each(function (i, e) {
        var $wrap = $('<div>').addClass('highlight-wrap')
        $(e).after($wrap)
        $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
          var code = $(this).parent().find(".code")[0].innerText
          
          var ta = document.createElement('textarea')
          document.body.appendChild(ta)
          ta.style.position = 'absolute'
          ta.style.top = '0px'
          ta.style.left = '0px'
          ta.value = code
          ta.select()
          ta.focus()
          var result = document.execCommand('copy')
          document.body.removeChild(ta)
          
            if(result)$(this).text('复制成功')
            else $(this).text('复制失败')
          
          $(this).blur()
        })).on('mouseleave', function (e) {
          var $b = $(this).find('.copy-btn')
          setTimeout(function () {
            $b.text('复制')
          }, 300)
        }).append(e)
      })
    })
  </script>

</body>
</html>